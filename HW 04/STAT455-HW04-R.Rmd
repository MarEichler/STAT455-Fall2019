---
output:
  pdf_document:
    fig_caption: yes
header-includes:
  - \usepackage{color}
  - \usepackage{mathtools}
  - \usepackage[labelformat=empty]{caption}
  - \usepackage{booktabs}
---
```{r, echo=FALSE, results="hide", warning=FALSE, message=FALSE}
library(boot)
library(knitr)
library(xtable)
library(ProfileLikelihood)
decimal <- function(x, k) trimws(format(round(x, k), nsmall=k))
dec <- 4
```
```{r global_options, R.options=knitr::opts_chunk$set(warning=FALSE, message=FALSE)}
```


# STAT 455 Homework 04 - R Code  
*Martha Eichlersmith*  
2019-11-07

## Problem 3.3
```{r}
shots <- matrix(c(251, 48, 34, 5), nrow=2, ncol=2)
chisq.test(shots, correct=FALSE)
```

## Problem 3.9a
```{r, message=FALSE}
r <- 5
c <- 2
names.r <- c("Schizophrenia", 
             "Affective disorder", 
             "Neurosis", 
             "Personality disorder", 
             "Special Systems")
names.c <- c("Drugs", "No Drugs")
row <- c(rep(1,c), rep(2, c), rep(3, c), rep(4, c), rep(5, c)) #row  data
column <- c(rep(c(1:2), r)) # column data
count <- c(105, 19, 8, 47, 12, 52, 2, 0, 18, 13)
count.m <- matrix(count, nrow=r, ncol=c)
rownames(count.m) <- names.r 
colnames(count.m) <- names.c
fit <- glm(count~as.factor(column)+as.factor(row), family=poisson(link="log"))
stdreschi <- glm.diag(fit)$rp #need book package 
res.matrix <- matrix(stdreschi, nrow=r, ncol=c, byrow=TRUE)
rownames(res.matrix) <- names.r 
colnames(res.matrix) <- names.c
t1 <- kable(count.m,    format="latex", booktabs=TRUE)
t2 <- kable(res.matrix, format="latex" , booktabs=TRUE)
```

```{r, echo=FALSE, results='asis'}
cat(c("\\begin{table}[!htb]
    \\begin{minipage}{.5\\linewidth}
      \\caption{Counts}
      \\centering",
        t1,
    "\\end{minipage}%
    \\begin{minipage}{.5\\linewidth}
      \\centering
        \\caption{Perason Standard Residuals}",
        t2,
    "\\end{minipage} 
\\end{table}"
))  
```


```{r, echo=FALSE, echo=FALSE, eval=FALSE}
align.vec <- c("l", rep("r", c))
xtable(count.m, digits=0, align=align.vec)
xtable(decimal(res.matrix, dec), align=align.vec)
```

```{r, message=FALSE, echo=FALSE, eval=FALSE}
r <- 3
c <- 3
count <- c(209, 101, 237, 151, 126, 426, 16, 21, 138)
kable(count.m, digits=0, align=c(rep('r', c)))
```


## Problem 3.15  
```{r}
count <- c(7, 8, 0, 15)
n <- sum(count)
Count <- matrix(count, nrow=2, ncol=2, byrow=TRUE)
OR <- (Count[1,1]*Count[2,2]) / (Count[1,2]*Count[2,1])

#WOOLF'S APPROXIMATE CI
se_log <- sqrt(  sum(1/count))
z.star <- qnorm(0.975, 0, 1)
CI.up_log <- log(OR) + z.star*se_log
CI.low_log <- log(OR) - z.star*se_log
CI.up <- exp(CI.up_log)
CI.low <- exp(CI.low_log)
Woolf_CI <- c(CI.low, CI.up)
```
```{r, echo=FALSE}
paste("OR:", decimal(OR, dec))
paste("Woolf CI Interval: (", decimal(Woolf_CI[1], dec), ",", decimal(Woolf_CI[2], dec), ")")
```

