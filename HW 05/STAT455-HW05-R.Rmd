---
title: STAT 455 Homework 05
author: Martha Eichlersmith
date: 2019-11-21
output:
  pdf_document:
    fig_caption: yes
header-includes:
  - \usepackage{color}
  - \usepackage{mathtools}
  - \usepackage{amsbsy} #bold in mathmode
  - \usepackage{nicefrac} # for nice fracs 
  - \usepackage{booktabs}
  - \usepackage{geometry}
  - \usepackage{caption} #to remove automatic table name and number - \captionsetup[table]{labelformat=empty}, put code under ---
geometry: "left=1.75cm,right=1.75cm,top=1.5cm,bottom=2cm" 

---
```{r setup, echo=FALSE, results="hide", warning=FALSE, message=FALSE}
library(ggplot2) #ggplot
library(readr) #import CSV
library(gridExtra) #organize plots
library(grid) #organize plots
library(latex2exp) #latex in ggplot titles 
library(gtable) #for tablegrob functions 
#library(kableExtra) #for kable functions
library(dplyr) #for piping 
library(xtable) #for latex table output 
knitr::opts_chunk$set(fig.width = 10, fig.height = 4)
#knitr::opts_chunk$set(echo=FALSE)
decimal <- function(x, k) trimws(format(round(x, k), nsmall=k))
dec <- 3
```


```{r rawdata}
Game <- c(1:23) #game number 
Made <- c(4, 5, 5, 5, 2, 7, 6, 9, 
          4, 1, 13, 5, 6, 9, 7, 3,
          8, 1, 18, 3, 10, 1, 3) #number of free throws made 
Attempt <- c(5, 11, 14, 12, 7, 10, 14, 15, 
             12, 4, 27, 17, 12, 9, 12, 10, 
             12, 6, 39, 13, 17, 6 ,12) #number of free throw attempt
Miss <- Attempt - Made #number of free throws missed 
```

```{r binarydata}
l <- length(Game) #23
FT <- c() #free throws vector (binary: 0 or 1)
G <- c() #game vector 
for (i in 1:l){
    made.i <- c(rep(1, Made[i]))
    miss.i <- c(rep(0, Miss[i]))
    new.game <- c(rep(Game[i], length(made.i)+length(miss.i)))
    FT <- c(FT, made.i, miss.i)
    G <- c(G, new.game)}

K <- c() 
for (j in 1:l){
  log.N.j <- log(Attempt[j])
  new.k <- rep(log.N.j, Attempt[j])
  K <- c(K, new.k)}

df.data <- data.frame("FT"=FT, "G"=G, "K"=K)
```

```{r samerate, warning=FALSE}
#test if pi_i- \alpha for each pi_i
#use linear regression 
lin.reg <- glm(FT ~ 1, data=df.data)
alpha <- summary(lin.reg)$coef[1,1]
se.alpha <- summary(lin.reg)$coef[1,2]
z.star <- qnorm(0.975)
CI.alpha <- cbind(alpha - z.star*se.alpha, alpha + z.star*se.alpha)
print.CI.alpha <- paste(decimal(CI.alpha, dec), collapse=",")

#chisq test - check Goodness of Fit 
table <- cbind(Made, Miss)
chi.test <- chisq.test(table)
X2 <- chi.test$statistic
pval <- chi.test$p.value

name <- c("$\\alpha$"
          , "Standard Error of $\\alpha$"
          , "Confidence Interval for $\\alpha$")
value <- c(decimal(alpha, dec), 
           decimal(se.alpha, dec),
           paste("(", print.CI.alpha, ")"))
samerate <- data.frame("Statistic" = name, "Values" = value)
caption.samerate <- c("Model $\\pi_i = \\alpha$")
knitr::kable(samerate, align='lr',caption=paste(caption.samerate))
```

```{r sametableLaTex, echo=FALSE, eval=FALSE}
xtable.sametable <- xtable(samerate, align="llr", caption=paste(caption.samerate))
print(xtable.sametable
      ,caption.placement="top"
      ,sanitize.text.function = function(x){x}
      )
```

```{r samerate.phi, warning = FALSE}
phi <- X2/(length(Game)-1)
se.phi <- sqrt(phi)*se.alpha
z.star <- qnorm(0.975)
CI.phi <- cbind(alpha - z.star*se.phi, alpha + z.star*se.phi)
print.CI.phi <- paste(decimal(CI.phi, dec), collapse=",")


name <- c("Dispersion, $\\hat{\\phi}$"
          , "Scale, $\\sqrt{\\hat{\\phi}}$"
          , "Standard Error of $\\alpha$, Adjusted"
          , "Confidence Interval for $\\alpha$, Adjusted")
value <- c(decimal(phi, dec), decimal(sqrt(phi), dec), decimal(se.phi, dec),
           paste("(", print.CI.phi, ")"))
samerate.phi <- data.frame("Statistic" = name, "Values" = value)
caption.samerate.phi <- c("Model $\\pi_i = \\alpha$, Estimate of $\\phi$ and Adjustements")
knitr::kable(samerate.phi, align="lr", caption=paste(caption.samerate.phi))
```

```{r sametable.phiLaTex, echo=FALSE, eval=FALSE}
xtable.sametable.phi <- xtable(samerate.phi, align="llr", caption=paste(caption.samerate.phi))
print(xtable.sametable.phi
      ,caption.placement="top"
      ,sanitize.text.function = function(x){x}
      )
```

