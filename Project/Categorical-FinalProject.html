
<!DOCTYPE html>
<html>
<head>
<style type="text/css">
.inline {
  background-color: #f7f7f7;
  border:solid 1px #B0B0B0;
}
.error {
	font-weight: bold;
	color: #FF0000;
}
.warning {
	font-weight: bold;
}
.message {
	font-style: italic;
}
.source, .output, .warning, .error, .message {
	padding: 0 1em;
  border:solid 1px #F7F7F7;
}
.source {
  background-color: #f5f5f5;
}
.left {
  text-align: left;
}
.right {
  text-align: right;
}
.center {
  text-align: center;
}
.hl.num {
  color: #AF0F91;
}
.hl.str {
  color: #317ECC;
}
.hl.com {
  color: #AD95AF;
  font-style: italic;
}
.hl.opt {
  color: #000000;
}
.hl.std {
  color: #585858;
}
.hl.kwa {
  color: #295F94;
  font-weight: bold;
}
.hl.kwb {
  color: #B05A65;
}
.hl.kwc {
  color: #55aa55;
}
.hl.kwd {
  color: #BC5A65;
  font-weight: bold;
}
</style>
  <script src="https://yihui.name/media/js/center-images.js"></script>
  <title>A Report Generated by knitr</title>
</head>
<body>

  <p>This report is automatically generated with the R
    package <a href="https://yihui.name/knitr/"><strong>knitr</strong></a>
    (version <code class="knitr inline">1.24</code>)
    .</p>

<div class="chunk" id="auto-report"><div class="rcode"><div class="source"><pre class="knitr r">---
title: <span class="hl str">&quot;Final Project; Categorical Data Analysis&quot;</span>
author: <span class="hl str">&quot;Abby Smith, Miruna Baronschi, Martha Eichlersmith&quot;</span>
date: <span class="hl str">&quot;2019-12-05&quot;</span>
output:
  pdf_document:
    fig_caption: yes
    number_sections: yes
header-includes: 
- \usepackage{color}
- \usepackage{mathtools}
- \usepackage{bbm} <span class="hl com">#<span class="hl kwa">for</span> mathbb <span class="hl kwa">for</span> numbers</span>
- \usepackage{amsbsy}
- \usepackage{caption}
- \usepackage{booktabs}
- \usepackage{geometry}
- \usepackage{float} <span class="hl com">#to hold things <span class="hl kwa">in</span> place</span>
- \usepackage{lastpage}
- \usepackage{fancyhdr}
- \usepackage{graphicx}
- \newcommand{\indep}{\rotatebox[origin=c]{90}{$\models$}}
- \pagestyle{fancy}
- \floatplacement{figure}{H}
- \fancyhf{}
- \fancyhead[L]{STAT 455 Fall 2019 \\ Final Project}
- \fancyhead[R]{Abby, Miruna, Martha \\ Page \thepage\ of\ \pageref*{LastPage}}
- \setlength{\headheight}{22.5pt} <span class="hl com">#to remove \fancyhead error <span class="hl kwa">for</span> head height</span>
geometry: left=0.75in,right=0.75in,top=1.1in,bottom=1in
---
```{r setup, include=F}
knitr::opts_chunk$<span class="hl kwd">set</span>(message=F, warning=F)

<span class="hl kwd">require</span>(tidyverse)
<span class="hl kwd">require</span>(janitor)
<span class="hl kwd">require</span>(rgdal)
<span class="hl kwd">require</span>(sp)
<span class="hl kwd">require</span>(sf)
<span class="hl kwd">require</span>(raster)
<span class="hl kwd">require</span>(Rcapture)
<span class="hl kwd">require</span>(dga)
<span class="hl kwd">require</span>(rgeos)
<span class="hl kwd">require</span>(MASS)
<span class="hl kwd">library</span>(bookdown) #<span class="hl kwa">for</span> fig captions
<span class="hl kwd">library</span>(kableExtra)

knitr::opts_chunk$<span class="hl kwd">set</span>(fig.width = 10, fig.height = 4)
knitr::opts_chunk$<span class="hl kwd">set</span>(echo=<span class="hl kwa">FALSE</span>)
knitr::opts_chunk$<span class="hl kwd">set</span>(fig.pos=<span class="hl str">'H'</span>)

```


<span class="hl com"># Estimates of Killing <span class="hl kwa">in</span> Casanare</span>

Casanare is a large, rural state <span class="hl kwa">in</span> Colombia that includes 19 municipalities and a population of almost 300,000 inhabitants. Located <span class="hl kwa">in</span> the foothills of the Andes, Casanare has a history of violence. <span class="hl kwd">Casanare</span> (alongside other states, including Arauca) became pivotal to the Colombian government <span class="hl kwa">in</span> the 1980s and 1990s when oil reserves were discovered there. Because of this natural resource, the government targeted opposition to what was perceived as the Colombian interest and modernization and the Union <span class="hl kwd">Patriotica</span> (UP) <span class="hl kwa">in</span> <span class="hl kwd">Casanare</span> (as well as Arauca), who supported people’s access to land and workers’ rights, became the victim. Multiple armed groups operated <span class="hl kwa">in</span> Casanare, including the Colombian military, paramilitaries, and guerrillas, going after “members” (both actual members and merely perceived supporters) of the UP. As a result, many Casanare citizens suffered violent deaths and disappearances. It can be argued that what was seen <span class="hl kwa">in</span> <span class="hl kwd">Casanare</span> (among other places) <span class="hl kwa">in</span> Colombia was “political” <span class="hl kwd">genocide</span> (Gomez-Suarez, 2007). But, one of the contentions against framing this episode <span class="hl kwa">in</span> Colombian history as a genocide is the low death and disappearances toll.

So how many people have been killed or disappeared? We review the Human Rights Data Analysis <span class="hl kwd">Group</span> (HRDAG)’s reporting on this issue of population <span class="hl kwd">estimation</span> (Guzman et al., 2007). In this study, the authors used information about victims of killings and disappearances provided by 15 datasets .Any accounting of lethal violence will be incorrect <span class="hl kwa">if</span> we assume that any one dataset or combination of datasets contains a comprehensive count of violent acts and disappearances. Registries of violent acts kept by governmental and non-governmental institutions contain some, but not all, of the records of lethal violence. Organizations collecting this data may only have access to certain subsets of a population or geographic areas


The datasets come from state agencies – including government, security, forensic and judicial bodies – and from civil society organizations. Across these 15 datasets, there are individuals that have been <span class="hl str">&quot;captured&quot;</span> only by one dataset, and some that have been captured by multiple. How can we disambiguate the patterns of violence?

\newpage  
# Multiple Systems <span class="hl kwd">Estimation</span> (MSE), Capture Re-Capture 

The goal is to estimate the overall population of victims by first estimating the victims who are not captured by any of the datasets.  MSE estimates the total number of disappearances by comparing the size of the <span class="hl kwd">overlap</span>(s) between lists to the sizes of the lists themselves. If the overlap is small, this implies that the population from which the lists were drawn is much larger than the lists. If, on the other hand, most of the cases on the lists overlap, this implies that the overall population is not much larger than the number of cases listed.


```{r img.MSE, fig.height=3, fig.cap=<span class="hl str">&quot;Multiple System Estimation^[Green, Amelia <span class="hl kwd">Hoover</span> (2013) Multiple Systems Estimation: Stratification and Estimation. Available HTTP: &lt;https://hrdag.org/2013/03/20/mse-stratification-estimation/&gt; (accessed 4 December 2019)]&quot;</span>}
<span class="hl kwd">library</span>(png)
<span class="hl kwd">library</span>(grid)
img &lt;- <span class="hl kwd">readPNG</span>(<span class="hl str">&quot;mse_review.png&quot;</span>)
 <span class="hl kwd">grid.raster</span>(img)
<span class="hl com">#![](mse_review.png) need to cite this</span>

```


<span class="hl com">## MSE Assumptions </span>

There are several MSE assumptions that are need <span class="hl kwa">for</span> when there are two <span class="hl str">&quot;systems&quot;</span> (lists), but not more than that. The assumptions are: 

1. *Closed system*: The population of interest does not change during the measurement period.  This means that the object of measurement, whether that is a population of persons <span class="hl kwa">in</span> a country or a population of violent events that occurred <span class="hl kwa">in</span> a state, is a closed system: the target population does not change during the period of measurement. This assumption is generally un-problematical <span class="hl kwa">for</span> data on violent events, because events that occurred cannot “un-occur” later.

2. *Perfect <span class="hl kwd">matching</span> (record linkage!)*: The overlap between <span class="hl kwd">systems</span> (i.e., the group of cases recorded <span class="hl kwa">in</span> more than one list) is perfectly identified.

3. *Equal probability of capture*: For every data system, each individual has an equal probability of being captured. For example, every death has probability X of being recorded <span class="hl kwa">in</span> list 1, every death has probability Y of being recorded <span class="hl kwa">in</span> list 2, and so on. This assumption, the homogeneity of capture probability, is unlikely to hold <span class="hl kwa">for</span> any type of violence data. For example, persons with fewer social connections may be both more likely to go missing and less likely to be reported missing; rural locations are more difficult to access than urban ones. Constructing two-sample estimates without accounting <span class="hl kwa">for</span> different probabilities of capture leads to conclusions that may be biased.

4. *Independence of lists*: Capture <span class="hl kwa">in</span> one list does not affect probability of capture <span class="hl kwa">in</span> another list. For example, being reported to one NGO does not change the probability that an individual is reported to another. The third assumption, independence of systems, is similarly difficult to meet.

Like differences <span class="hl kwa">in</span> capture probability, dependencies between systems are impossible to account <span class="hl kwa">for</span> in the the two-system setting. A common example here is the difference between governmental and non-governmental organizations. Because different populations may have different levels of trust <span class="hl kwa">in</span> the two organizations, reporting to one type of organization may imply that the witness is very unlikely to report to the other. 

<span class="hl com"># Overview of Data </span>

```{r data-sources}
casanare&lt;- <span class="hl kwd">read_delim</span>(<span class="hl str">'summary-table.csv'</span>, delim= <span class="hl str">&quot;|&quot;</span>)

casanare_capture_recapture &lt;- casanare %&gt;%
  dplyr::<span class="hl kwd">select</span>(-<span class="hl kwd">c</span>(vln, muni, year)) #just want a matrix of 0s and 1s 

cols_lists &lt;- casanare_capture_recapture %&gt;% dplyr::<span class="hl kwd">select</span>(<span class="hl kwd">starts_with</span>(<span class="hl str">&quot;d_&quot;</span>))
  
#this <span class="hl kwa">function</span> returns any instance of a <span class="hl str">&quot;capture&quot;</span> <span class="hl kwa">for</span> each org
return_1 &lt;-<span class="hl kwd"><span class="hl kwa">function</span></span>(x) {
  casanare_capture_recapture %&gt;%
   <span class="hl kwd">filter</span>(x ==1) %&gt;% 
  <span class="hl kwd">summarize</span>(n=<span class="hl kwd">sum</span>(Freq)) %&gt;% dplyr::<span class="hl kwd">select</span>(n)

}

#<span class="hl kwd">unlist</span>(<span class="hl kwd">map</span>(cols_lists, return_1))

unique_records&lt;- casanare_capture_recapture %&gt;%
  <span class="hl kwd">mutate</span>(sum_cols = <span class="hl kwd">reduce</span>(dplyr::<span class="hl kwd">select</span>(., <span class="hl kwd">starts_with</span>(<span class="hl str">&quot;d_&quot;</span>)), `+`)) %&gt;% 
  <span class="hl kwd">filter</span>(sum_cols == 1)  

unique_records&lt;-unique_records %&gt;%
  <span class="hl kwd">group_by</span>(d_CCJ, d_EQU, d_FON, d_IMLD ,d_PN0 ,d_CIN, d_FAM ,
           d_FSR, d_IMLM,  d_VP, d_CCE, d_CTI, d_FDC, d_GAU , d_PL) %&gt;%
  <span class="hl kwd">summarise</span>(n = <span class="hl kwd">sum</span>(Freq))


# print table with each data source and total records <span class="hl str">&quot;captured&quot;</span>
org_names &lt;- <span class="hl kwd">c</span>(<span class="hl str">&quot;Colombian Commission of Jurists&quot;</span>, <span class="hl str">&quot;Equitas&quot;</span>, <span class="hl str">&quot;Fondelibertad&quot;</span>, <span class="hl str">&quot;National Institute of Forensic Medicine Disappearances&quot;</span>, <span class="hl str">&quot;Policía Nacional &quot;</span>, <span class="hl str">&quot;CINEP &quot;</span>, <span class="hl str">&quot;Families of Victims’ Organizations&quot;</span>,<span class="hl str">&quot;Prosecutor General of Santa Rosa&quot;</span>, <span class="hl str">&quot;Instituto Nacional de Medicina Legal &quot;</span>, <span class="hl str">&quot;Vice Presidency Office&quot;</span>, <span class="hl str">&quot;Colombia-Europe&quot;</span>, <span class="hl str">&quot;Technical Investigative Body of the Prosecutor Generals Office&quot;</span>, <span class="hl str">&quot;Prosecutor General list of the Disappeared&quot;</span>, <span class="hl str">&quot;Gaula&quot;</span>,<span class="hl str">&quot;Pais Libre&quot;</span> ) 


contigency_table&lt;-<span class="hl kwd">data.frame</span>(org = org_names,
           total_captures= <span class="hl kwd">unlist</span>(<span class="hl kwd">map</span>(cols_lists, return_1)),
           only_captured_in_this = <span class="hl kwd">c</span>(48,0, 67,9,221,91,1,0,1219,284,30,0,376,1,0),
           type = <span class="hl kwd">c</span>(<span class="hl str">&quot;judicial&quot;</span>, <span class="hl str">&quot;civil&quot;</span>, <span class="hl str">&quot;security&quot;</span>, <span class="hl str">&quot;forensic&quot;</span>, <span class="hl str">&quot;security&quot;</span>,
                    <span class="hl str">&quot;civil&quot;</span>,<span class="hl str">&quot;civil&quot;</span>, <span class="hl str">&quot;security&quot;</span>,<span class="hl str">&quot;forensic&quot;</span>, <span class="hl str">&quot;judicial&quot;</span>, <span class="hl str">&quot;civil&quot;</span>, <span class="hl str">&quot;judicial&quot;</span>,
                    <span class="hl str">&quot;forensic&quot;</span>, <span class="hl str">&quot;security&quot;</span>, <span class="hl str">&quot;civil&quot;</span>)) #just hard coded whoops

<span class="hl kwd">colnames</span>(contigency_table) &lt;- <span class="hl kwd">c</span>(<span class="hl str">&quot;Organization&quot;</span>, <span class="hl str">&quot;Total Captures&quot;</span>, <span class="hl str">&quot;Unique&quot;</span>, <span class="hl str">&quot;Type&quot;</span>)

knitr::<span class="hl kwd">kable</span>(contigency_table, format=<span class="hl str">&quot;latex&quot;</span>, booktabs=T, caption=<span class="hl str">&quot;Contingency Table&quot;</span>) %&gt;% 
  kableExtra::<span class="hl kwd">kable_styling</span>(latex_options=<span class="hl str">&quot;scale_down&quot;</span>) %&gt;%
  kableExtra::<span class="hl kwd">kable_styling</span>(latex_options = <span class="hl str">&quot;HOLD_position&quot;</span>)

```

<span class="hl com">## Overall Trends  </span>

The following graph shows that violence has been concentrated <span class="hl kwa">in</span> Yopal.  We can see that the *reported* <span class="hl kwd">violence</span> (i.e. the counts <span class="hl kwa">in</span> the 15 datasets) appears to have intensified across all municipalities <span class="hl kwa">in</span> Casanare <span class="hl kwa">in</span> 2003-2004 and then dropped.

```{r mapping-whole-country}
<span class="hl com">#group deaths by municipality</span>
muni &lt;- casanare %&gt;% <span class="hl kwd">mutate</span>(name_2= <span class="hl kwd">str_to_title</span>(muni)) %&gt;%<span class="hl kwd">group_by</span>(name_2)  %&gt;% <span class="hl kwd">summarise</span>(count = <span class="hl kwd">sum</span>(Freq))

colombia_dat &lt;- <span class="hl kwd">getData</span>(<span class="hl str">'GADM'</span>, country=<span class="hl str">'COL'</span>, level = 2) %&gt;% 
  <span class="hl kwd">st_as_sf</span>() %&gt;% 
  <span class="hl kwd">clean_names</span>()

casanare_dat &lt;-  colombia_dat %&gt;% 
  <span class="hl kwd">filter</span>(name_1 == <span class="hl str">&quot;Casanare&quot;</span>) %&gt;%  
  <span class="hl kwd">mutate</span>(name_2 =  stringi::<span class="hl kwd">stri_trans_general</span>(name_2, <span class="hl str">&quot;Latin-ASCII&quot;</span>))%&gt;% #removes accents <span class="hl kwa">for</span> joining purposes
  <span class="hl kwd">mutate</span>(name_2 = <span class="hl kwd">str_to_title</span>(name_2)) %&gt;%
  <span class="hl kwd">left_join</span>( muni, by =<span class="hl kwd">c</span>(<span class="hl str">'name_2'</span>)) 
 
casanare_overall_plot &lt;- <span class="hl kwd">ggplot</span>(casanare_dat, <span class="hl kwd">aes</span>(fill = count)) +<span class="hl kwd">scale_fill_gradient</span>(low=<span class="hl str">'white'</span>, high= <span class="hl str">'red'</span>)+ 
  <span class="hl kwd">geom_sf</span>() +
  <span class="hl kwd">theme_void</span>() + 
  <span class="hl kwd">ggtitle</span>(<span class="hl str">'Total Counts <span class="hl kwa">in</span> 15 Datasets by Municipality 1998-2007'</span>)
    
```

```{r mapping-by-muni}
<span class="hl com">#partition by years</span>
<span class="hl com">#group deaths by municipality</span>
muni_by_year&lt;- casanare %&gt;% <span class="hl kwd">mutate</span>(name_2 = <span class="hl kwd">str_to_title</span>(muni)) %&gt;%
  <span class="hl kwd">group_by</span>(name_2, year)  %&gt;% 
  <span class="hl kwd">summarise</span>(count = <span class="hl kwd">sum</span>(Freq))

casanare_dat_with_years &lt;-  colombia_dat %&gt;% 
  <span class="hl kwd">filter</span>(name_1 == <span class="hl str">&quot;Casanare&quot;</span>) %&gt;%  
  <span class="hl kwd">mutate</span>(name_2 =  stringi::<span class="hl kwd">stri_trans_general</span>(name_2, <span class="hl str">&quot;Latin-ASCII&quot;</span>))%&gt;%
  <span class="hl kwd">mutate</span>(name_2 = <span class="hl kwd">str_to_title</span>(name_2)) %&gt;%
  <span class="hl kwd">left_join</span>( muni_by_year, by =<span class="hl kwd">c</span>(<span class="hl str">'name_2'</span>)) 


 
casanare_by_years &lt;- <span class="hl kwd">ggplot</span>(casanare_dat_with_years, <span class="hl kwd">aes</span>(fill = count)) +<span class="hl kwd">scale_fill_gradient</span>(low=<span class="hl str">'white'</span>, high= <span class="hl str">'red'</span>)+ 
  <span class="hl kwd">geom_sf</span>() +
  <span class="hl kwd">theme_void</span>() + <span class="hl kwd">facet_wrap</span>( ~ year)+
  <span class="hl kwd">ggtitle</span>(<span class="hl str">'Yearly Counts <span class="hl kwa">in</span> 15 Datasets by Municipality 1998-2007'</span>)
```

```{r gisplots, fig.cap=<span class="hl str">&quot;Overall Trends <span class="hl kwa">in</span> 15 Datasets by Municipality&quot;</span>}
gridExtra::<span class="hl kwd">grid.arrange</span>(casanare_overall_plot, casanare_by_years, nrow=1)
```


Looking just at the totals of the 15 datasets, that data suggest the violence peaked <span class="hl kwa">in</span> 2003-2004 and the total number of victims is 3501.  However, just looking at the trends among the totals of the 15 datasets does not give the whole picture.  

<span class="hl com">## Heterogeneity Issues</span>

One of the requirements <span class="hl kwa">for</span> MSE is <span class="hl kwa">for</span> each individual has equal probability of capture <span class="hl kwa">for</span> a given list.  However, we can see from the figure below this does not seem to be the case.  In 2004, the violence was centered around Villanueva, but all three of these lists have very little counts <span class="hl kwa">in</span> that location.  Since these individual list charts have different gradient trends than the total, that suggest that there is heterogeneity <span class="hl kwa">in</span> capture probability.  This will make our results more uncertain.  


```{r threeorg2004, fig.height=2.5, fig.cap=<span class="hl str">&quot;Counts from Three Different Datasets <span class="hl kwa">in</span> 2004&quot;</span>}
gather_cols &lt;-<span class="hl kwd">colnames</span>(casanare %&gt;% dplyr::<span class="hl kwd">select</span>(<span class="hl kwd">starts_with</span>(<span class="hl str">&quot;d_&quot;</span>)))
for_2004&lt;- <span class="hl kwd">pivot_longer</span>(casanare, cols= gather_cols, names_to=<span class="hl str">'data_lists'</span>, values_to=<span class="hl str">'indicator'</span>) %&gt;% <span class="hl kwd">filter</span>(indicator == 1) %&gt;%
  <span class="hl kwd">filter</span>(data_lists == <span class="hl str">&quot;d_PN0&quot;</span> | data_lists == <span class="hl str">&quot;d_IMLM&quot;</span> |  data_lists == <span class="hl str">&quot;d_CIN&quot;</span>)  %&gt;% <span class="hl kwd">filter</span>(year == 2004) %&gt;%
  <span class="hl kwd">mutate</span>(name_2 = <span class="hl kwd">str_to_title</span>(muni)) 

test_this &lt;- colombia_dat %&gt;% <span class="hl kwd">filter</span>(name_1 == <span class="hl str">&quot;Casanare&quot;</span>) %&gt;%  
  <span class="hl kwd">mutate</span>(name_2 =  stringi::<span class="hl kwd">stri_trans_general</span>(name_2, <span class="hl str">&quot;Latin-ASCII&quot;</span>))%&gt;%
  <span class="hl kwd">mutate</span>(name_2 = <span class="hl kwd">str_to_title</span>(name_2)) %&gt;%
  <span class="hl kwd">full_join</span>(for_2004, by =<span class="hl kwd">c</span>(<span class="hl str">'name_2'</span>))

hetromap &lt;- <span class="hl kwd">ggplot</span>(test_this, <span class="hl kwd">aes</span>(fill= Freq)) + <span class="hl kwd">scale_fill_gradient</span>(low=<span class="hl str">'white'</span>, high= <span class="hl str">'red'</span>)+ 
  <span class="hl kwd">geom_sf</span>() +
  <span class="hl kwd">theme_void</span>() + <span class="hl kwd">facet_wrap</span>( ~ data_lists)+ <span class="hl kwd">ggtitle</span>(<span class="hl str">'Disappearances/Kidnappings Across Municipalities by Different Organizations, <span class="hl kwa">in</span> 2004'</span>)

hetromap
```

<span class="hl com">## Different Datasets - Different Stories </span>

We motivate our need <span class="hl kwa">for</span> a more sophisticated analysis by showing the reporting patterns of 3 different organizations across 1998-2007. If we relied on just one organization or even a combination of two we could tell different stories regarding the violence. Relying on FAM shows a peak <span class="hl kwa">in</span> violent incidents <span class="hl kwa">in</span> 2003, <span class="hl kwa">while</span> reports by IMLM show a peak <span class="hl kwa">in</span> 2004 . Using multiple systems estimation allows us to parse both the reported and unreported violent <span class="hl kwa">in</span> Casanare.

```{r motivation-plot}
<span class="hl com">#list by year</span>

casanare_long &lt;-  <span class="hl kwd">gather</span>(casanare, key = <span class="hl str">&quot;data_lists&quot;</span>, value= <span class="hl str">'Freq'</span>, gather_cols) %&gt;% 
  <span class="hl kwd">filter</span>(data_lists == <span class="hl str">&quot;d_GAU&quot;</span> | data_lists == <span class="hl str">&quot;d_IMLM&quot;</span> |  data_lists == <span class="hl str">&quot;d_FAM&quot;</span>) %&gt;%
  <span class="hl kwd">group_by</span>(data_lists,year) %&gt;% <span class="hl kwd">summarise</span>(n = <span class="hl kwd">sum</span>(Freq))
                                                                                      

motivation.plot &lt;- <span class="hl kwd">ggplot</span>(casanare_long, <span class="hl kwd">aes</span>(x= <span class="hl kwd">factor</span>(year), y= <span class="hl kwd">as.integer</span>(n), fill = <span class="hl kwd">as.factor</span>(data_lists)))+
  <span class="hl kwd">geom_bar</span>(stat=<span class="hl str">'identity'</span>, position=<span class="hl str">'dodge'</span>) + <span class="hl kwd">xlab</span>(<span class="hl str">&quot;Year&quot;</span>) + <span class="hl kwd">ylab</span>(<span class="hl str">&quot;Reported Disappearances/Deaths&quot;</span>) +
  <span class="hl kwd">ggtitle</span>(<span class="hl str">'Reported Disappearances/Deaths <span class="hl kwa">in</span> Casanare'</span>) +
  <span class="hl kwd">guides</span>(fill = <span class="hl kwd">guide_legend</span>(title=<span class="hl str">'Lists'</span>))  + 
  <span class="hl kwd">theme_bw</span>()
```

```{r, fig.cap= <span class="hl str">'Count Trends <span class="hl kwa">for</span> Three Organizations'</span>}
motivation.plot 
```


\newpage  
<span class="hl com"># Loglinear Modelling </span>

In order to do our estimation, we will use loglinear modeling.  We will describe the model as <span class="hl kwa">if</span> we had two <span class="hl kwd">datasets</span> (<span class="hl kwa">for</span> simplicity).  We know the victims <span class="hl str">&quot;captured&quot;</span> by only dataset 1, only dataset 2, and both datasets.  However, we don't know the amount of victims that are not captured by either list.  Estimate this value allows us to estimate the total count of victims.  

```{r img.example, fig.height=3,echo=<span class="hl kwa">FALSE</span>}
<span class="hl kwd">library</span>(png)
<span class="hl kwd">library</span>(grid)
#img &lt;- <span class="hl kwd">readPNG</span>(<span class="hl str">&quot;2datasetexample.png&quot;</span>)
 #<span class="hl kwd">grid.raster</span>(img)
```

The count of victims captured into a dataset or combination of datasets is $n_{11}, n_{10}, n_{01}$, and $n_{00}$.  Each of these cells is a count of victims captured. The subscripts denote which datasets a victim has been captured.  The subscripts denotes <span class="hl kwa">if</span> the victim has been <span class="hl kwd">captured</span> (1), or not been captured by a certain data set.  For $n_{ij}$, $i$ is <span class="hl kwa">for</span> dataset #1 and $j$ is dataset #2.  

Our estimates are primarily based on Poisson regression. 

<span class="hl com">## Estimating the Total Count of Victims </span>

We are interested <span class="hl kwa">in</span> estimating $n_{00}$, which also allows us to estimate the total number of victims.  
<span class="hl kwd">The</span> (log of the) expected cell count $n_{00}$ is a <span class="hl kwa">function</span> of the other observed cell counts, as shown <span class="hl kwa">in</span> the equation below.

$$
<span class="hl kwd">\log</span>(n_{00}) = \alpha 
+ \beta_1 \cdot \mathbbm{1}(x\<span class="hl kwa">in</span> n_{10}) 
+ \beta_2 \cdot \mathbbm{1}(x\<span class="hl kwa">in</span> n_{01}) 
$$

This is the saturated form of the log-linear models introduced <span class="hl kwa">in</span> Bishop, Fienberg and <span class="hl kwd">Holland</span> (1975). To quote from Agresti, <span class="hl str">&quot;the saturated GLM has a separate parameter <span class="hl kwa">for</span> each observation. It gives a perfect fit. This sounds good, but it is not a helpful model. It does not smooth the data or have the advantages that a simpler model has, such as parsimony. Nonetheless, it serves as a baseline <span class="hl kwa">for</span> other models, such as <span class="hl kwa">for</span> checking model fit.&quot;</span>

When estimation of the total “population” of missing people <span class="hl kwa">in</span> Casanare is the <span class="hl kwd">goal</span> (as it typically is with multiple-systems estimation), the key value here is the intercept $\alpha$. To estimate $<span class="hl kwd">\log</span>(n_{00}$), all the other values <span class="hl kwa">in</span> the model are zero, as the indicator functions <span class="hl kwa">for</span> $n_{ij}$ <span class="hl kwa">for</span> zero. Therefore the only term that contributes to the estimate of $<span class="hl kwd">\log</span>(n_{00}$) is $\alpha$. The value of $n_{00}$ is therefore the exponentiated value of $a$, that is, $<span class="hl kwd">\exp</span>(\alpha)$. The total number of cases, $N$, is the sum of the observed cases plus $<span class="hl kwd">\exp</span>(\alpha)$.  

$$
\begin{aligned}
<span class="hl kwd">\log</span>(n_{00}) &amp;= \alpha 
\underbrace{
+ \beta_1 \cdot  \mathbbm{1}(x\<span class="hl kwa">in</span> n_{10}) 
+ \beta_2 \cdot \mathbbm{1}(x\<span class="hl kwa">in</span> n_{01}) 
}_{\text{each }=0}
\\[.5ex]
<span class="hl kwd">\log</span>(n_{00}) &amp; = \alpha 
\\[.5ex]
\hat{n}_{00} &amp; = \exp \left\{ \hat{\alpha} \right\}
\\[3ex]
\hat{N} &amp;= n_{11} + n_{10} + n_{01} + \hat{n}_{00}
\end{aligned}
$$

As with any regression and data mining model, we want to avoid over-fitting. There is a trade off we need to balance between <span class="hl str">&quot;goodness of fit&quot;</span>, and <span class="hl kwd">simple</span> (parsimonious) models.

We need to find the best model <span class="hl kwa">in</span> order to get an accurate estimate of $\alpha$. Thus, we should determine whether the <span class="hl kwd">full</span> (saturated) model above, which assumes that all three two-way interactions between datasets are important, is actually necessary. There is one simpler models that assume the two-way interaction.

$$
<span class="hl kwd">\log</span>(n_{00}) = \alpha 
+ \beta_1 \cdot \mathbbm{1}(x\<span class="hl kwa">in</span> n_{10}) 
+ \beta_2 \cdot \mathbbm{1}(x\<span class="hl kwa">in</span> n_{01}) 
+ \beta_{12} \cdot \mathbbm{1}(x \<span class="hl kwa">in</span> n_{11})
$$



In this case, we can clearly write out the possible model.  During model selection, we estimate these models and choose the model that minimizes the Bayesian Information <span class="hl kwd">Criterion</span> (BIC), a test that weighs goodness of fit against degrees of freedom.


<span class="hl com">## Challenges with Loglinear models</span>

1.  **Interpretation:** The inclusion of so many variables <span class="hl kwa">in</span> loglinear models often makes interpretation very difficult. 
2. **Independence Assumption:** The frequency <span class="hl kwa">in</span> each cell is independent of frequencies <span class="hl kwa">in</span> all other cells, which is not necessarily the case here. We attempt to model this.
3. **Sample Size Requirement:** With loglinear models, you need to have at least 5 times the number of cases as cells <span class="hl kwa">in</span> your data.  If you do not have the required amount of cases, then you need to increase the sample size or eliminate one or more of the variables.


## Choosing our <span class="hl str">&quot;Systems&quot;</span>

Our dataset encompasses 15 datasets, far too many to model with a loglinear model. We collapse these 15 datasets into 4 <span class="hl kwd">systems</span> (i.e. groups) based on the type of organization that produced the dataset.   

```{r adding-systems}
#want to count how many records are <span class="hl kwa">in</span> just one of <span class="hl kwd">these</span> (or both) of these lists vs. these + another system
cap_indicators&lt;- casanare_capture_recapture  %&gt;% #could have used <span class="hl kwd">fct_collapse</span>() here
  <span class="hl kwd">mutate</span>(security_ind = <span class="hl kwd">case_when</span>((d_GAU == 1 | d_FON == 1 | d_PN0==1) ~ 1,
                                 <span class="hl kwa">TRUE</span> ~ 0),
         forensic_ind = <span class="hl kwd">case_when</span>( (d_IMLM == 1 | d_IMLD==1) ~1 ,
                                   <span class="hl kwa">TRUE</span> ~ 0), 
        judicial_ind = <span class="hl kwd">case_when</span>( (d_CCJ == 1 |d_FSR == 1 | d_CTI == 1 |d_VP ==1 | d_FDC ==1) ~1 ,
                                   <span class="hl kwa">TRUE</span> ~ 0),
        civil_ind = <span class="hl kwd">case_when</span>( (d_EQU==1 | d_FAM== 1 | d_PL == 1 |d_CCE==1 | d_CIN == 1) ~1 ,
                                   <span class="hl kwa">TRUE</span> ~ 0)
         )  %&gt;%
  dplyr::<span class="hl kwd">select</span>(-Freq, Freq) # move Freq to last column <span class="hl kwa">for</span> <span class="hl kwd">closedp</span>() function

table.system &lt;- <span class="hl kwd">head</span>(cap_indicators %&gt;% dplyr::<span class="hl kwd">select</span>(security_ind, forensic_ind, judicial_ind, civil_ind, Freq))

knitr::<span class="hl kwd">kable</span>(table.system, format=<span class="hl str">&quot;latex&quot;</span>, booktabs=T
                      , caption=<span class="hl str">&quot;Example of Information from Systems&quot;</span>
                      ,linesep=<span class="hl str">&quot;&quot;</span>
                      ) %&gt;% 
  #kableExtra::<span class="hl kwd">kable_styling</span>(latex_options=<span class="hl str">&quot;scale_down&quot;</span>) %&gt;% <span class="hl kwa">for</span> if the table is too large
  kableExtra::<span class="hl kwd">kable_styling</span>(latex_options = <span class="hl str">&quot;HOLD_position&quot;</span>)

```

```{r systems.venndiagram, fig.height=5, fig.wdith=6, fig.cap=<span class="hl str">&quot;Estimated Venn Diagram of Systems&quot;</span>}
for_venn &lt;- cap_indicators[,<span class="hl kwd">c</span>(16:20)] %&gt;% 
  <span class="hl kwd">group_by</span>(security_ind, forensic_ind, judicial_ind, civil_ind) %&gt;%
   <span class="hl kwd">summarise</span>(new_Freq = <span class="hl kwd">sum</span>(Freq))
<span class="hl kwd">par</span>(mar=<span class="hl kwd">c</span>(.1,1,2,1)) #make margins smaller
dga::<span class="hl kwd">venn4</span>(<span class="hl kwd">c</span>(2000,for_venn$new_Freq),num.test.points = 100000, main=<span class="hl str">'Overlap of Security, Forensic, Judicial and Civil lists'</span>) #rough diagram of overlap
```
  
  
In the above Venn Diagram, the colored dots represent a specific victim.  We are trying to estimate the victims that are not captured <span class="hl kwa">in</span> one of the <span class="hl kwd">lists</span> (shown by the graph dots).  We can see there is not a lot of overlap, which suggests there may be lack of heterogeneity capture <span class="hl kwd">probability</span> (i.e. the probability of a victim captured differs from list to list).  In addition, this implies that there is likely a much larger population of victims than counted <span class="hl kwa">in</span> the 15 datasets.  


<span class="hl com">## Model Definitions  </span>

<span class="hl com">### Types of Models  </span>

Models will be denoted by $M$, and the subscripts will denote the type of model. 

* $M_0$: The $M_0$ model is the simplest possible multiple source capture recapture model. It assumes that there is no heterogeneity and that all <span class="hl kwd">lists</span> (civil, security, judicial, etc) have the same probability of capturing individuals. We know that this is not the case here.
* $M_t$: This model relaxes the $M_0$ model to allow <span class="hl kwa">for</span> lists to have different capture rates.
* $M_h$: This model relaxes the $M_0$ model to allow <span class="hl kwa">for</span> individual capture heterogeneity.
* $M_{th}$: This model allows <span class="hl kwa">for</span> both list heterogeneity and capture events having different rates.

<span class="hl com">### Types of Heterogeneity  </span>

When heterogeneity <span class="hl kwa">in</span> capture probability is <span class="hl kwd">present</span> (i.e. the probability of a list capturing a victims differs), there are different forms that this heterogeneity can take. 

* Normal: The log odds of capture follows a Normal distribution.
* Darroch: The log odds of capture among those who were not captured follows a Normal distribution.
* Poisson: The log odds of capture among those who were not captured follows a Poisson distribution.
* Gamma: The log odds of capture among those who were not captured follows a Gamma distribution.


<span class="hl com">## Non-Hierarchical Models</span>

After collapsing the 15 lists into four systems, we fit several loglinear models. We see that the best fits clearly take into account both system and individual heterogeneity. We therefore choose the $M_{th}$ model with the log odds of capture among those who were not captured follows a Gamma distribution. We see that the $M_0$ model demonstrates a clear lack of fit, which we would expect <span class="hl kwa">for</span> this data. The models listed below are *not* hierarchical <span class="hl kwa">in</span> nature. 

We will need the hierarchical structure to perform model selection. It’s important to note that a model is not chosen <span class="hl kwa">if</span> it bears no resemblance to the observed data.  The choice of a preferred model is typically based on a formal comparison of goodness-of-fit statistics associated with models that are related <span class="hl kwd">hierarchically</span> (models containing higher order terms also implicitly include all lower order terms).  Ultimately, the preferred model should distinguish between the pattern of the variables <span class="hl kwa">in</span> the data and sampling variability, thus providing an intuitive interpretation.  

The “number of captured units” is the number of observed elements, <span class="hl kwa">in</span> this example, the number of people documented as missing/killed, we usually call this $N_c$ ($N$ <span class="hl kwa">for</span> overall total, and $c$ denoting captured. The “abundance” column shows the estimate of $\hat{N}$, the total population including the observed and the estimated unobserved deaths. The AIC and BIC columns show the “information coefficients” which balance the goodness of <span class="hl kwd">fit</span> (shown <span class="hl kwa">in</span> the “deviance” column) with the information used to estimate the <span class="hl kwd">model</span> (degrees of freedom indicate this).  Model selection often occurs based on the smallest AIC and BIC values, however this can only be done with hierarchical models which is not the case here.  

```{r NOT-HIERCH-models}
test &lt;- cap_indicators[,<span class="hl kwd">c</span>(16:20)] %&gt;% 
  <span class="hl kwd">group_by</span>(security_ind, forensic_ind, judicial_ind, civil_ind) %&gt;%
  <span class="hl kwd">summarise</span>(new_Freq = <span class="hl kwd">sum</span>(Freq))


loglinear_models &lt;- <span class="hl kwd">closedp.t</span>(test, dfreq=T)
NonHierchModels &lt;- loglinear_models$results

#table.logmodels &lt;- <span class="hl kwd">as.data.frame</span>(loglinear_models)
knitr::<span class="hl kwd">kable</span>(<span class="hl kwd">round</span>(NonHierchModels[,1:6], 3)
             , format=<span class="hl str">&quot;latex&quot;</span>
             , booktabs=T
             , caption=<span class="hl str">&quot;Summary of <span class="hl kwd">Models</span> (Non-hierarchical models)&quot;</span>
             , linesep=<span class="hl str">&quot;&quot;</span>) %&gt;% 
  #kableExtra::<span class="hl kwd">kable_styling</span>(latex_options=<span class="hl str">&quot;scale_down&quot;</span>) %&gt;%
  kableExtra::<span class="hl kwd">kable_styling</span>(latex_options = <span class="hl str">&quot;HOLD_position&quot;</span>)

```

Each model controls <span class="hl kwa">for</span> a subset of all the possible interactions among the models. In the context of MSE, the two- and three-way interactions <span class="hl kwd">estimate</span> (and to some extent, control <span class="hl kwa">for</span>) associations <span class="hl kwa">in</span> the probabilities of capture <span class="hl kwd">between</span> (and among) the lists. For example, is a certain person more likely to be seen on one list, and also more likely to be seen on a second list? If associations like this are <span class="hl kwd">present</span> (and they usually are), they can bias the estimate.


```{r NOT-HIERCH-models-boxplot, fig.cap=<span class="hl str">&quot;Boxplot of Residuals <span class="hl kwa">for</span> Models&quot;</span>}
<span class="hl kwd">par</span>(mar=<span class="hl kwd">c</span>(2,1,2,1)) #make margins smaller
<span class="hl kwd">boxplot</span>(loglinear_models) #residuals <span class="hl kwa">for</span> heterogen.
```
  
  
These boxplots of residuals offer a general assessment of model fit.  These boxplots of residuals offer a general assessment of model fit. 

Since the individual cell counts: 
$$n_i \sim <span class="hl kwd">Pois</span>(m_i)$$

$$E[n_i] = <span class="hl kwd">Var</span>(n_i) = m_i $$

it follows that the Pearson residuals:

$$r_i = \frac{n_i - \hat{m_i}}{<span class="hl kwd">\sqrt</span>(m_i)} $$

are approximately mean 0, variance 1. This is why they are sensible residuals to use.

The light dotted line represents zero, and ideally you want the residuals centered around zero.  We see that there is significantly less variation <span class="hl kwa">in</span> the $M_{th}$ Models.  These models account <span class="hl kwa">for</span> list <span class="hl kwd">heterogeneity</span> (probability of capture <span class="hl kwa">for</span> a specific victim varies from list to list) and individual <span class="hl kwd">heterogeneity</span> (probability of capture <span class="hl kwa">for</span> a specific list varies from victim to victim).  Models that account <span class="hl kwa">for</span> heterogeneity offer less variation but also do not have residuals centered at zero.  

<span class="hl com">## Specific Model Results </span>

```{r modelProfileLike, fig.cap=<span class="hl str">'Profile Likelihood of Specific Model'</span>}
<span class="hl kwd">par</span>(mar=<span class="hl kwd">c</span>(4,4,2,1)) #make margins smaller
profilelike &lt;- <span class="hl kwd">profileCI</span>(test,dfreq=T, m = <span class="hl str">&quot;Mth&quot;</span>, h = <span class="hl str">&quot;Darroch&quot;</span>, a=2) #profile likelihood CI
```

```{r modelProfileLikeCI}
knitr::<span class="hl kwd">kable</span>(<span class="hl kwd">round</span>(profilelike$results, 2), format=<span class="hl str">&quot;latex&quot;</span>, booktabs=T, caption=<span class="hl str">&quot;Confidence Interval of Specific Model&quot;</span>) %&gt;% 
  kableExtra::<span class="hl kwd">kable_styling</span>(latex_options = <span class="hl str">&quot;HOLD_position&quot;</span>)
```

\newpage  
<span class="hl com">## Capture Recapture</span>

We display some basic capture-recapture frequency statistics to explore capture patterns. It displays, <span class="hl kwa">for</span> $i= 1,...t$, the number of people captured $i$ <span class="hl kwd">times</span> ($f_i$), the number of people captured <span class="hl kwa">for</span> the first time on occasion $i$ ($u_i$), the number of units captured <span class="hl kwa">for</span> the last time on occasion $i$ ($v_i$) and the number of units captured on occasion $i$ ($n_i$). Here <span class="hl str">&quot;occasion&quot;</span> should be interpreted as one of the four <span class="hl str">&quot;systems&quot;</span>-- where security is the 1st system, forensic is the 2nd, judicial is the 3rd, and civil is the 4th <span class="hl str">&quot;occasion&quot;</span>. 

If the $n_i$ statistics vary among capture occasions, there is a temporal effect-- which we clearly see here. We would expect the top panel of the plot to be linear, <span class="hl kwa">while</span> the bottom panel should be concave down or exhibit no pattern <span class="hl kwa">for</span> capture patterns that are best fit with $M_{th}$ models. 

```{r descriptive-stats}
desc&lt;- <span class="hl kwd">descriptive</span>(test, dfreq = T)
descstat &lt;- <span class="hl kwd">t</span>(desc$base.freq)
<span class="hl kwd">rownames</span>(descstat) &lt;- <span class="hl kwd">c</span>(
   <span class="hl str">&quot;fi: number of units captured i times&quot;</span>
  ,<span class="hl str">&quot;ui: number of units captured <span class="hl kwa">for</span> the first time on occasion i&quot;</span>
  ,<span class="hl str">&quot;vi: number of units captured <span class="hl kwa">for</span> the last time on occasion i&quot;</span>
  ,<span class="hl str">&quot;ni: number of units captured on occasion i&quot;</span>
)

knitr::<span class="hl kwd">kable</span>(descstat, format=<span class="hl str">&quot;latex&quot;</span>, booktabs=T, caption=<span class="hl str">&quot;Capture Recapture Statistics&quot;</span>) %&gt;% 
  kableExtra::<span class="hl kwd">kable_styling</span>(latex_options = <span class="hl str">&quot;HOLD_position&quot;</span>)
```

$$<span class="hl kwd">\log\left</span>(\frac{f_i}{{t \choose i}}\right) = \log <span class="hl kwd">\left</span>(\frac{N \times <span class="hl kwd">P</span>(i \text{ captures})}{{t \choose i}}\right) = <span class="hl kwd">\log</span>(<span class="hl kwd">N</span>(1-p)^{t-i} p^i = <span class="hl kwd">\log</span>(<span class="hl kwd">N</span>(1-p)^t) + <span class="hl kwd">i\log\left</span>(\frac{p}{1-p}\right)$$

```{r descriptive-plot, fig.height=6, fig.cap=<span class="hl str">&quot;Capture-Recapture Frequency Statistics&quot;</span>}
<span class="hl kwd">plot</span>(desc)
```

\newpage  
<span class="hl com">## Hierarchical Models</span>

<span class="hl com">### More Interactions: Better Fit</span>

We start by fitting three simple models.  The first, and simplest, is the model that assumes independence between the four systems.  The second model looks at all possible two-way interactions.  The third models looks at all three-way interaction between each of the systems. Recall that 1=Security, 2=Forensic, 3=Judicial, and 4=Civil.  


$$
\begin{aligned}
\text{Model 1:} \quad <span class="hl kwd">\log</span>(\hat{N}) &amp;= \alpha + \lambda_1 + \lambda_2 + \lambda_3 + \lambda_4 
\\
\text{Model 2:} \quad <span class="hl kwd">\log</span>(\hat{N}) &amp;= \alpha + \lambda_1 + \lambda_2 + \lambda_{13} + \lambda_{14} +
\lambda_{23} + \lambda_{24} + \lambda_{34}  
\\
\text{Model 3:} \quad <span class="hl kwd">\log</span>(\hat{N}) &amp;= \alpha +  \lambda_1 + \lambda_2 + \lambda_{13} + \lambda_{14} +
\lambda_{23} + \lambda_{24} + \lambda_{34}  + \lambda_{123} + \lambda_{124} + \lambda_{134} + \lambda_{234} 
\\
\end{aligned}
$$

 We perform log-likelihood ratio test and see that the higher the order of the interaction, the better the <span class="hl kwd">fit</span> (with saturated model signifying a perfect fit). The model <span class="hl kwd">deviance</span> (LR statistic <span class="hl kwa">for</span> testing against the saturated model) <span class="hl kwa">for</span> each is defined as:
$$G^{2}=2 \sum_{i} n_{i} \log <span class="hl kwd">\left</span>(n_{i} / \hat{m}_{i}\right)=\sum_{i} d_{i} $$

We perform log-likelihood ratio test and see that the higher the order of the interaction, the greater the deviance explained. Each LRT <span class="hl kwa">for</span> the nested models demonstrates that- the p-value <span class="hl kwa">for</span> the reduction <span class="hl kwa">in</span> deviance is significant.  Note that these obey the **hierarchy principle**: If the $k$-way interaction is <span class="hl kwa">in</span> the model then every lower order interaction and main effect is also <span class="hl kwa">in</span> the model. 

```{r hierch_models1}
independence_model &lt;- <span class="hl kwd">loglm</span>(new_Freq ~ security_ind + forensic_ind + judicial_ind + civil_ind, data=test)

no_three &lt;- <span class="hl kwd">loglm</span>(new_Freq ~ security_ind*forensic_ind + security_ind*judicial_ind + security_ind*civil_ind + forensic_ind*judicial_ind + forensic_ind*civil_ind + judicial_ind*civil_ind, data=test)

no_four_way &lt;- <span class="hl kwd">loglm</span>(new_Freq ~ security_ind*forensic_ind*judicial_ind*civil_ind - security_ind:forensic_ind:judicial_ind:civil_ind, data=test)

anovafit &lt;- <span class="hl kwd">anova</span>(independence_model, no_three, no_four_way, test=<span class="hl str">&quot;LR&quot;</span>) #LRT 

anova.table &lt;- anovafit[1:4,]


knitr::<span class="hl kwd">kable</span>(anova.table, format=<span class="hl str">&quot;latex&quot;</span>, booktabs=T, caption=<span class="hl str">&quot;ANOVA <span class="hl kwa">for</span> 3 standard models&quot;</span>) %&gt;% 
  kableExtra::<span class="hl kwd">kable_styling</span>(latex_options = <span class="hl str">&quot;HOLD_position&quot;</span>)
```

<span class="hl com">### Iterative Proportional Fitting</span>

We will use iterative proportional fitting to estimate $N$.  The iterative proportional fitting process generates maximum likelihood estimates of the expected cell frequencies <span class="hl kwa">for</span> a hierarchical model.  In short, preliminary estimates of the expected cell frequencies are successfully adjusted to fit each of the marginal sub-tables specified <span class="hl kwa">in</span> the model.The un-adjusted data cells may be referred to as the ‘seed’ cells, and the selected totals may be referred to as the ‘marginal’ totals.  
Here the marginal subtables would be:

1. Security by Judicial by Forensic systems
2. Security by Forensic by Civil systems
3. Judicial by Forensic by Civil systems
4. Judicial by Civil by by Security  systems


To do this four-dimensional IPF:

1. Proportionally adjust <span class="hl kwd">each</span> (three-dimensional) row of cells to equal the pre-determined totals of Marginal 1.
2. Proportionally adjust each column of cells to equal the pre-determined totals of Marginal 2.
3. Proportionally adjust each slice of cells to equal the pre-determined totals of Marginal 3.
4. Proportionally adjust each stack of cells to equal the pre-determined totals of Marginal 4. This is the end of the first ‘Iteration’.
5. Repeat the above steps until the desired level of convergence is reached.  

Under mild restrictions, we know that the cell-values at the end of this process that satisfy the fitted marginal totals are the MLEs.

<span class="hl com">### Results </span>

Using iterative proportional fitting, we fit all possible second-order interaction <span class="hl kwd">models</span> (we restrict to second-order to aid interpretation). These will account <span class="hl kwa">for</span> different dependency structures. 

We choose he best model according to the BIC criteria, is below: estimates a total <span class="hl kwa">for</span> missing/disappeared people as $8817$, which is similar to the  $8782$ than that of the non-hierch., interactionless, <span class="hl kwd">model</span> ($M_{th}$). 

```{r hierch-models2}
hierch_models &lt;- <span class="hl kwd">closedpMS.t</span>(test, dfreq=T ,h=<span class="hl str">'Poisson'</span>, maxorder = 2) #restrict to second order interactions 

Top &lt;- hierch_models$results[1:5,]
Middle &lt;- hierch_models$results[30:34,]
Bottom &lt;- hierch_models$results[60:64,]
HierchModels &lt;- <span class="hl kwd">rbind</span>(Top, Middle, Bottom) 
rnames &lt;- <span class="hl kwd">rownames</span>(HierchModels) 
<span class="hl kwd">rownames</span>(HierchModels)&lt;- <span class="hl kwd">gsub</span>(<span class="hl str">&quot;\\[|\\]&quot;</span>, <span class="hl str">&quot;&quot;</span>, rnames)
<span class="hl com">#get rid fo brackets otherwise booktabs goes all wonky</span>

knitr::<span class="hl kwd">kable</span>(HierchModels[,1:6], format=<span class="hl str">&quot;latex&quot;</span>
             , booktabs=T
             , caption=<span class="hl str">&quot;`Top<span class="hl str">' Five, `Middle'</span> Five, and `Bottom' Five <span class="hl kwd">Models</span> (Hierarchical models)&quot;</span>) %&gt;% 
  #kableExtra::<span class="hl kwd">kable_styling</span>(latex_options=<span class="hl str">&quot;scale_down&quot;</span>) %&gt;%
  kableExtra::<span class="hl kwd">kable_styling</span>(latex_options = <span class="hl str">&quot;HOLD_position&quot;</span>)
```
```{r estimaterange}
MAX.EST &lt;- <span class="hl kwd">max</span>(hierch_models$results[,1])
MIN.EST &lt;- <span class="hl kwd">min</span>(hierch_models$results[,1])
results &lt;- <span class="hl kwd">as.data.frame</span>(<span class="hl kwd">cbind</span>(<span class="hl str">&quot;abundance&quot;</span>=hierch_models$results[,1], <span class="hl str">&quot;BIC&quot;</span>=hierch_models$results[,6] ))
BIC.results &lt;- results[results$BIC &lt; 300,]
MAX.goodBIC.EST &lt;- <span class="hl kwd">max</span>(BIC.results[,1])
MIN.goodBIC.EST &lt;- <span class="hl kwd">min</span>(BIC.results[,1])
```

We can see that the independence model listed as <span class="hl str">&quot;1,2,3,4&quot;</span> has the worst fit-- this is to be expected, as we have demonstrated <span class="hl kwa">in</span> previous sections the list dependencies

The shorthand <span class="hl str">&quot;14,2,3&quot;</span> means that lists 1 and 4 are independent of 2, and also independent of list 3, i.e. $(1,4) \indep 2$ and $(1,4) \indep 3$. It is represented by:

$$<span class="hl kwd">\log</span>(\hat{N}) = \alpha + \lambda_1 + \lambda_2 + \lambda_3 + \lambda_4  + \lambda_{14} $$

The shorthand identifies both the model and the margins that must be fitted to obtain MLEs using IPF. Not all shorthands have a conditional independence interpretation. The top models, all with 5-6 two-way interactions cannot be interpreted <span class="hl kwa">in</span> this way.

These the hierarchical models have different estimates, ranging from 5053 to 9268.

We also plot the BIC values <span class="hl kwa">for</span> different models and their accompanying estimates of $\hat{N}$.  When we only look at estimates with a corresponding BIC value less 300, the estimates range from 5077 and <span class="hl kwd">9268</span> (almost the exact same range of estimates when considering all the models).  

```{r hierch-modelsBIC, fig.cap=<span class="hl str">&quot;Hiercharical Models BIC Plot&quot;</span>}
<span class="hl kwd">plot</span>(hierch_models) #BIC <span class="hl kwa">for</span> a bunch of different models 
```

This is the fundamental problem of the frequentist approach. We could just pick the “best” model, i.e., the one with the lowest <span class="hl kwd">BIC</span> (note the y-axis is inverted).

Unfortunately, just picking one model ignores the error that we introduce by the selection itself. It also forces us to decide which dependencies among the systems we will control <span class="hl kwa">for</span>, forcing us to decide which dependencies will not be included <span class="hl kwa">in</span> the model. In the future, we would look into model averaging procedures and Bayesian approaches.


<span class="hl com"># Conclusions  </span>

Our findings show that the total number of deaths and disappearances <span class="hl kwa">in</span> Casanare is far greater than previously assessed. The initial analysis made by Guzman et al. <span class="hl kwa">for</span> the Human Rights Data Analysis <span class="hl kwd">Group</span> (HRDAG), which used thirteen datasets from 1986-2007, estimated a total of 2,533 deaths and disappearances <span class="hl kwa">in</span> <span class="hl kwd">Casanare</span> (95% CI: 2239-2867) from 1986-2007, although only about 1,500 were reported as <span class="hl kwd">such</span> (Guzman et al., 2007). We only used datasets <span class="hl kwa">for</span> a subset of those years, namely 1998-<span class="hl kwd">2007</span> (fifteen datasets <span class="hl kwa">in</span> total). Looking at just the raw total from the fifteen datasets, there were 3,501 incidents of deaths or disappearances <span class="hl kwa">in</span> Casanare from 1998-2007. Had our analysis also included data that went back to 1986, the raw total would be even higher.
 
Importantly, given estimation techniques used <span class="hl kwa">in</span> our analysis, there is strong evidence that the true total of victims is actually much higher than 3,501. We used multiple systems <span class="hl kwd">estimation</span> (MSE) and loglinear modeling to show that the best hierarchical models of the data produce estimates ranging from 5,077 to 9,268. While our estimation of the total number of deaths and disappearances indicates a far greater number of victims, there are some concerns estimating the true total of victims. First, the models themselves indicate a large range of possible numbers. Second, the data may not meet all the MSE and loglinear <span class="hl kwd">assumptions</span> (especially the independence assumption), which makes point estimation less valid.


As can be seen, there is a lot of uncertainty about the true total of deaths and disappearances. Nevertheless, the number of deaths and disappearances within any given country is one important human rights measure that serves six inter-related functions: (1) contextual description and documentation, (2) classification, (3) monitoring, (4) mapping and pattern recognition, (5) analysis and policy recommendation, <span class="hl kwd">and</span> (6) advocacy and political <span class="hl kwd">dialogue</span> (Landman and Carvalho, 2009). While MSE and loglinear modeling can only go so far <span class="hl kwa">in</span> terms of the first four functions, these statistical tools <span class="hl kwa">for</span> better estimating the total of deaths and disappearances is nevertheless key <span class="hl kwa">for</span>, on the one hand, analysis and policy recommendation, and on the other, advocacy and political dialogue. International NGOs like Amnesty International and Human Rights Watch respond based on the severity of human rights violations <span class="hl kwa">in</span> a country, opting to use higher estimates of deaths and disappearances <span class="hl kwa">for</span> their analysis of the situation <span class="hl kwa">in</span> Colombia and thus their recommendations and advocacy, <span class="hl kwa">while</span> the Colombian think tank, CERAC, have lower <span class="hl kwd">estimates</span> (Ballesteros et al., 2007). Unfortunately, different estimates can be used as fact by different groups to proffer differing messages about the extent of human rights violations <span class="hl kwa">in</span> Colombia. Nevertheless, utilizing statistical tools to show that the true total of victims is markedly higher than previously reported is particularly important <span class="hl kwa">for</span> uncovering the extant nature and degree of violence <span class="hl kwa">in</span> Colombia. 


<span class="hl com"># References</span>

Agresti, <span class="hl kwd">A.</span> (2003). Introduction to Categorical Data Analysis. 394.

Ballesteros, A., Restrepo, J., Spagat, M., and Vargas, <span class="hl kwd">J.</span> (2007) The Work of Amnesty International and Human Rights Watch: Evidence from Colombia, Bogota, Colombia: Centro de Recursos para el Analisis de Conflictos. Online. Available HTTP: &lt;http://cerac.org.co/assets/pdf/Other%20publications/CERAC_WP_4.pdf&gt; (accessed 4 December 2019).

Christensen, <span class="hl kwd">R.</span> (2006). Log-Linear Models and Logistic Regression. Springer Science &amp; Business Media.

Darroch, J., Fienberg, S., Gary F. V. Glonek, &amp; Junker, <span class="hl kwd">B.</span> (1993). A Three-Sample Multiple-Recapture Approach to Census Population Estimation with Heterogeneous Catchability. Journal of the American Statistical Association, <span class="hl kwd">88</span>(423), 1137-1148. doi:10.2307/2290811

Gomez-Suarez, <span class="hl kwd">Andre</span> (2007). “Perpetrator blocs, genocidal mentalities and geographies: the destruction of the Union Patriotica <span class="hl kwa">in</span> Colombia and its lessons <span class="hl kwa">for</span> genocide studies.” Journal of Genocide Research9:4, 637-660.

Guzman, D., Guberek, T., Hoover, A. and Ball, <span class="hl kwd">P.</span> (2007) Missing People <span class="hl kwa">in</span> Casanare, Palo Alto, CA: Human Rights Data Analysis Group. Palo Alto, CA: Benetech Initiative. Online. Available HTTP: &lt;www.hrdag.org/resources/publications/casanare-missing- report.pdf&gt; (accessed 4 2019). 

Junker, <span class="hl kwd">B.</span> (2007). Carnegie Mellon Lecture Notes: 36-720: Log-Linear Models: Three-Way Tables. Retrieved from &lt;http://www.stat.cmu.edu/~brian/720/week03/04-loglinear.pdf&gt;

Landman, Todd and Carvalho, <span class="hl kwd">Edzia</span> (2009). Measuring Human Rights. London: Routledge.

Mitchell, <span class="hl kwd">Shira</span> (2014). Capture-recapture Estimation <span class="hl kwa">for</span> Conflict Data and Hierarchical Models <span class="hl kwa">for</span> Program Impact Evaluation. Retrieved from &lt;https://dash.harvard.edu/bitstream/handle/1/12274610/Mitchell_gsas.harvard_0084L_11586.pdf?sequence=4&amp;isAllowed=y&gt;


```{r printcode}
<span class="hl com">#PRINTING THE CODE</span>
#knitr::<span class="hl kwd">stitch</span>(<span class="hl str">&quot;HW06.Rmd&quot;</span>) to go to latex
#knitr::<span class="hl kwd">stitch</span>(   script=<span class="hl str">&quot;Categorical-FinalProject.Rmd&quot;</span>  , <span class="hl kwd">system.file</span>(<span class="hl str">&quot;misc&quot;</span>, <span class="hl str">&quot;knitr-template.Rhtml&quot;</span>, package=<span class="hl str">&quot;knitr&quot;</span>)) #code to HTML
```
</pre></div>
<div class="error"><pre class="knitr r">## Error: &lt;text&gt;:10:3: unexpected input
## 9: header-includes: 
## 10: - \
##       ^
</pre></div>
</div></div>

  <p>The R session information (including the OS info, R version and all
    packages used):</p>

<div class="chunk" id="session-info"><div class="rcode"><div class="source"><pre class="knitr r">    <span class="hl kwd">sessionInfo</span><span class="hl std">()</span>
</pre></div>
<div class="output"><pre class="knitr r">## R version 3.6.1 (2019-07-05)
## Platform: x86_64-w64-mingw32/x64 (64-bit)
## Running under: Windows 10 x64 (build 17763)
## 
## Matrix products: default
## 
## locale:
## [1] LC_COLLATE=English_United States.1252  LC_CTYPE=English_United States.1252   
## [3] LC_MONETARY=English_United States.1252 LC_NUMERIC=C                          
## [5] LC_TIME=English_United States.1252    
## 
## attached base packages:
## [1] grid      stats     graphics  grDevices utils     datasets  methods   base     
## 
## other attached packages:
##  [1] png_0.1-7        kableExtra_1.1.0 bookdown_0.12    MASS_7.3-51.4    rgeos_0.5-2     
##  [6] dga_1.2          Rcapture_1.4-2   raster_3.0-7     sf_0.8-0         rgdal_1.4-8     
## [11] sp_1.3-1         janitor_1.2.0    forcats_0.4.0    stringr_1.4.0    dplyr_0.8.3     
## [16] purrr_0.3.2      readr_1.3.1      tidyr_1.0.0      tibble_2.1.3     ggplot2_3.2.1   
## [21] tidyverse_1.2.1 
## 
## loaded via a namespace (and not attached):
##  [1] Rcpp_1.0.2         lubridate_1.7.4    lattice_0.20-38    class_7.3-15      
##  [5] assertthat_0.2.1   zeallot_0.1.0      digest_0.6.20      R6_2.4.0          
##  [9] cellranger_1.1.0   chron_2.3-54       backports_1.1.4    evaluate_0.14     
## [13] e1071_1.7-2        highr_0.8          httr_1.4.1         pillar_1.4.2      
## [17] rlang_0.4.0        lazyeval_0.2.2     readxl_1.3.1       rstudioapi_0.10   
## [21] rmarkdown_1.14     labeling_0.3       webshot_0.5.1      munsell_0.5.0     
## [25] broom_0.5.2        compiler_3.6.1     modelr_0.1.5       xfun_0.8          
## [29] pkgconfig_2.0.2    htmltools_0.3.6    tidyselect_0.2.5   gridExtra_2.3     
## [33] codetools_0.2-16   viridisLite_0.3.0  crayon_1.3.4       withr_2.1.2       
## [37] nlme_3.1-140       jsonlite_1.6       gtable_0.3.0       lifecycle_0.1.0   
## [41] DBI_1.0.0          magrittr_1.5       units_0.6-5        scales_1.0.0      
## [45] KernSmooth_2.23-15 cli_1.1.0          stringi_1.4.3      snakecase_0.11.0  
## [49] xml2_1.2.2         ellipsis_0.2.0.1   generics_0.0.2     vctrs_0.2.0       
## [53] tools_3.6.1        glue_1.3.1         hms_0.5.0          yaml_2.2.0        
## [57] colorspace_1.4-1   classInt_0.4-2     rvest_0.3.4        knitr_1.24        
## [61] haven_2.1.1
</pre></div>
<div class="source"><pre class="knitr r">    <span class="hl kwd">Sys.time</span><span class="hl std">()</span>
</pre></div>
<div class="output"><pre class="knitr r">## [1] &quot;2019-12-05 09:59:46 CST&quot;
</pre></div>
</div></div>


</body>
</html>
